"use strict";(()=>{var e={};e.id=432,e.ids=[432],e.modules={6517:e=>{e.exports=require("lodash")},9283:e=>{e.exports=require("lodash/at")},770:e=>{e.exports=require("lodash/clone")},9131:e=>{e.exports=require("lodash/compact")},8390:e=>{e.exports=require("lodash/extend")},9368:e=>{e.exports=require("lodash/filter")},2265:e=>{e.exports=require("lodash/first")},1238:e=>{e.exports=require("lodash/includes")},5599:e=>{e.exports=require("lodash/isArray")},9699:e=>{e.exports=require("lodash/isEmpty")},5716:e=>{e.exports=require("lodash/isFunction")},7078:e=>{e.exports=require("lodash/isNumber")},5795:e=>{e.exports=require("lodash/isObject")},5452:e=>{e.exports=require("lodash/isPlainObject")},7026:e=>{e.exports=require("lodash/isString")},2133:e=>{e.exports=require("lodash/isUndefined")},3824:e=>{e.exports=require("lodash/last")},3707:e=>{e.exports=require("lodash/map")},1516:e=>{e.exports=require("lodash/take")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1017:e=>{e.exports=require("path")},3477:e=>{e.exports=require("querystring")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},547:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>x,originalPathname:()=>f,requestAsyncStorage:()=>d,routeModule:()=>n,serverHooks:()=>c,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>q});var o={};t.r(o),t.d(o,{GET:()=>GET,POST:()=>POST}),t(8976);var s=t(884),a=t(6132),i=t(5798),u=t(9636);u.v2.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let l=null,p=0;async function POST(e){try{let r=await e.formData(),t=r.getAll("files");if(!t||0===t.length)return i.Z.json({error:"No files uploaded"},{status:400});let o=t.map(async e=>{let r=await e.arrayBuffer(),t=Buffer.from(r);return new Promise((e,r)=>{u.v2.uploader.upload_stream({resource_type:"image",folder:"birthday",format:"webp",quality:"auto:good",fetch_format:"auto",eager:[{width:400,height:400,crop:"fill"},{width:1200,height:1200,crop:"fit"}],eager_async:!0},(t,o)=>{t?r(t):e(o)}).end(t)})}),s=await Promise.all(o);return l=null,i.Z.json(s)}catch(e){return i.Z.json({error:"Failed to upload photos"},{status:500})}}async function GET(e){try{let{searchParams:r}=new URL(e.url),t=parseInt(r.get("page")||"1"),o=parseInt(r.get("limit")||"30"),s=(t-1)*o,a=Date.now();if(l&&a-p<3e5){let e=l.slice(s,s+o);return i.Z.json({resources:e,total:l.length,page:t,totalPages:Math.ceil(l.length/o)})}let{resources:n}=await u.v2.search.expression("folder:birthday").with_field("context").max_results(500).execute();l=n,p=a;let d=n.slice(s,s+o);return i.Z.json({resources:d,total:n.length,page:t,totalPages:Math.ceil(n.length/o)})}catch(e){return i.Z.json({error:"Failed to fetch photos"},{status:500})}}let n=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/photos/route",pathname:"/api/photos",filename:"route",bundlePath:"app/api/photos/route"},resolvedPagePath:"C:\\bday\\app\\api\\photos\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:c,headerHooks:x,staticGenerationBailout:q}=n,f="/api/photos/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[955,636],()=>__webpack_exec__(547));module.exports=t})();